package org.projectmanagement.controller;

import lombok.RequiredArgsConstructor;
import org.projectmanagement.model.dto.project.ProjectCreateDto;
import org.projectmanagement.model.dto.project.ProjectReadDto;
import org.projectmanagement.model.dto.project.ProjectResponseDto;
import org.projectmanagement.model.payload.ResponseMessage;
import org.projectmanagement.service.ProjectService;
import org.springframework.dao.DataAccessException;
import org.springframework.http.HttpStatus;
import org.springframework.http.ResponseEntity;
import org.springframework.web.bind.annotation.*;
import java.util.List;

@RestController
@RequestMapping("/project")
@RequiredArgsConstructor
public class ProjectController {

    private final ProjectService projectService;

    @PostMapping(value = "create")
    public ResponseEntity<?> createProject(@RequestBody ProjectCreateDto projectCreateDto) {
        try {
            ProjectResponseDto createProject = projectService.createProject(projectCreateDto);
            return new ResponseEntity<>(ResponseMessage.builder()
                    .message("Project created successfully")
                    .object(createProject)
                    .build(),
                    HttpStatus.CREATED);
        } catch (DataAccessException e) {
            return new ResponseEntity<>(ResponseMessage.builder()
                    .message(e.getMessage())
                    .build(),
                    HttpStatus.BAD_REQUEST
            );
        }
    }

    //Este metodo devuelve todos los projects de un user que sea scrum master
    // @Param user_id el id del scrum master
    @GetMapping(value = "projects")
    public ResponseEntity<?> getProjects(@RequestBody String scrum_master_id) {
        try{

            List<ProjectReadDto> getProjects = projectService.getProjects(scrum_master_id);
            return new ResponseEntity<>(ResponseMessage.builder()
                    .message("Projects retrieved successfully")
                    .object(getProjects)
                    .build(),
                    HttpStatus.OK);

        }catch (DataAccessException e) {
            return new ResponseEntity<>(ResponseMessage.builder()
                    .message(e.getMessage())
                    .build(),
                    HttpStatus.BAD_REQUEST
            );
        }

    }
 }
